@model List<VendorX.Models.ExpenseCategory>

@{
    ViewData["Title"] = "Manage Categories";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0 text-gray-800">
        <i class="bi bi-tags"></i> Manage Expense Categories
    </h1>
    <div>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createCategoryModal">
            <i class="bi bi-plus-circle"></i> Add New Category
        </button>
        <a asp-action="Index" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Back to Expenses
        </a>
    </div>
</div>

<div class="row g-3">
    @if (Model == null || !Model.Any())
    {
        <div class="col-12">
            <div class="alert alert-info">
                <i class="bi bi-info-circle"></i> No custom categories created yet. Click "Add New Category" to create one.
            </div>
        </div>
    }
    else
    {
        @foreach (var category in Model)
        {
            <div class="col-md-4">
                <div class="card shadow-sm h-100 border-start border-@category.Color border-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div class="expense-icon bg-@category.Color bg-opacity-10 p-2 rounded-3">
                                <i class="bi @category.Icon fs-3 text-@category.Color"></i>
                            </div>
                            <form asp-action="DeleteCategory" asp-route-id="@category.ExpenseCategoryId" method="post" style="display: inline;">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete this category?')">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </form>
                        </div>
                        <h5 class="card-title fw-bold">@category.CategoryName</h5>
                        @if (!string.IsNullOrEmpty(category.Description))
                        {
                            <p class="card-text text-muted small">@category.Description</p>
                        }
                        <div class="mt-3">
                            <span class="badge bg-@category.Color">@category.Color</span>
                            <span class="badge bg-secondary">@category.Icon</span>
                        </div>
                    </div>
                </div>
            </div>
        }
    }
</div>

<!-- Create Category Modal -->
<div class="modal fade" id="createCategoryModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="bi bi-plus-circle"></i> Create New Category</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form asp-action="CreateCategory" method="post">
                @Html.AntiForgeryToken()
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Category Name *</label>
                        <input type="text" name="CategoryName" class="form-control" placeholder="e.g., Office Supplies" required />
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea name="Description" class="form-control" rows="2" placeholder="Optional description"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Icon *</label>
                        <select name="Icon" class="form-select" required>
                            <option value="bi-cash-stack">?? Cash Stack</option>
                            <option value="bi-lightning-charge">? Lightning (Electricity)</option>
                            <option value="bi-house-door">?? House Door (Rent)</option>
                            <option value="bi-droplet">?? Water Droplet</option>
                            <option value="bi-wifi">?? WiFi (Internet)</option>
                            <option value="bi-fire">?? Fire (Gas)</option>
                            <option value="bi-person-badge">?? Person Badge (Salary)</option>
                            <option value="bi-tools">?? Tools (Maintenance)</option>
                            <option value="bi-clipboard">?? Clipboard (Office)</option>
                            <option value="bi-megaphone">?? Megaphone (Marketing)</option>
                            <option value="bi-truck">?? Truck (Transport)</option>
                            <option value="bi-shield-check">??? Shield (Insurance)</option>
                            <option value="bi-file-earmark-text">?? Document (License)</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Color *</label>
                        <select name="Color" class="form-select" required>
                            <option value="primary">?? Primary (Blue)</option>
                            <option value="success">?? Success (Green)</option>
                            <option value="danger">?? Danger (Red)</option>
                            <option value="warning">?? Warning (Yellow)</option>
                            <option value="info">?? Info (Cyan)</option>
                            <option value="secondary">? Secondary (Gray)</option>
                            <option value="dark">? Dark (Black)</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-save"></i> Create Category
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Auto-close modal on success
        @if (TempData["Success"] != null)
        {
            <text>
            $('#createCategoryModal').modal('hide');
            </text>
        }
    </script>
}
